<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Relat√≥rio Geral</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #5a60ea;
      margin-bottom: 30px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .tabs button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background-color: #eef1f6;
      color: #333;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .tabs button.active {
      background-color: #5a60ea;
      color: white;
    }
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: #5a60ea;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .stats {
      margin-top: 10px;
      font-weight: bold;
      color: #444;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .btn-apagar {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-apagar:hover {
      background-color: #c0392b;
    }
    .btn-voltar {
      display: block;
      margin: 30px auto 0;
      padding: 12px 20px;
      background-color: #5a60ea;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .btn-voltar:hover {
      background-color: #3f45c4;
    }
    .muted {
      color: #666;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Relat√≥rio Geral</h1>

    <div class="tabs">
      <button class="active" onclick="mostrarAba(event, 'alunos')">üë®‚Äçüéì Alunos</button>
      <button onclick="mostrarAba(event, 'professores')">üë©‚Äçüè´ Professores</button>
      <button onclick="mostrarAba(event, 'cursos')">üìö Cursos</button>
    </div>

    <!-- Alunos -->
    <div id="aba-alunos" class="tab-content active">
      <input type="text" id="filtroAlunos" placeholder="Buscar aluno..." oninput="filtrar('alunos')" />
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>CPF</th>
            <th>Email</th>
            <th>Faculdade</th>
            <th>Mat√©ria</th>
            <th>Nota</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaAlunos"></tbody>
      </table>
      <div class="stats" id="statsAlunos"></div>
    </div>

    <!-- Professores -->
    <div id="aba-professores" class="tab-content">
      <input type="text" id="filtroProfessores" placeholder="Buscar professor..." oninput="filtrar('professores')" />
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>CPF</th>
            <th>Email</th>
            <th>Departamento</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaProfessores"></tbody>
      </table>
      <div class="stats" id="statsProfessores"></div>
    </div>

    <!-- Cursos -->
    <div id="aba-cursos" class="tab-content">
      <input type="text" id="filtroCursos" placeholder="Buscar curso..." oninput="filtrar('cursos')" />
      <table>
        <thead>
          <tr>
            <th>Curso</th>
            <th>Professor</th>
            <th>Alunos</th>
            <th>Qtd</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaCursos"></tbody>
      </table>
      <div class="stats" id="statsCursos"></div>
      <p class="muted">Obs.: A lista de alunos por curso mostra os nomes salvos no momento do cadastro do curso.</p>
    </div>

    <button class="btn-voltar" onclick="voltar()">‚Üê Voltar para Cadastro</button>
  </div>

  <script>
    function mostrarAba(event, nome) {
      document.querySelectorAll('.tab-content').forEach(div => div.classList.remove('active'));
      document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`aba-${nome}`).classList.add('active');
      event.target.classList.add('active');
      filtrar(nome);
    }

    function voltar() {
      window.location.href = "index.html";
    }

    function apagar(tipo, idxOriginal) {
      if (!confirm("Deseja apagar este registro?")) return;
      const lista = JSON.parse(localStorage.getItem(tipo)) || [];
      if (idxOriginal >= 0 && idxOriginal < lista.length) {
        lista.splice(idxOriginal, 1);
        localStorage.setItem(tipo, JSON.stringify(lista));
      }
      filtrar(tipo);
    }

    function obterLista(tipo) {
      return JSON.parse(localStorage.getItem(tipo)) || [];
    }

    // Mant√©m o √≠ndice original mesmo ap√≥s filtro
    function filtrar(tipo) {
      const termo = (document.getElementById(`filtro${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`)?.value || "").toLowerCase();
      const base = obterLista(tipo);
      const mapeado = base.map((obj, idx) => ({ obj, idx }));
      const filtrado = !termo
        ? mapeado
        : mapeado.filter(item =>
            Object.values(item.obj).some(val => String(val).toLowerCase().includes(termo))
          );
      renderizarTabela(tipo, filtrado);
    }

    function renderizarTabela(tipo, listaMapeada) {
      if (tipo === "alunos") {
        const tabela = document.getElementById("tabelaAlunos");
        tabela.innerHTML = "";
        listaMapeada.forEach(({ obj: a, idx }) => {
          tabela.innerHTML += `
            <tr>
              <td>${a.nome}</td>
              <td>${a.cpf}</td>
              <td>${a.email}</td>
              <td>${a.faculdade}</td>
              <td>${a.materia}</td>
              <td>${a.nota}</td>
              <td><button class="btn-apagar" onclick="apagar('alunos', ${idx})">Apagar</button></td>
            </tr>`;
        });
        const qtd = listaMapeada.length;
        const media = qtd
          ? (listaMapeada.reduce((s, { obj }) => s + Number(obj.nota || 0), 0) / qtd).toFixed(2)
          : 0;
        document.getElementById("statsAlunos").textContent = `Total: ${qtd} | M√©dia de notas: ${media}`;
      }

      if (tipo === "professores") {
        const tabela = document.getElementById("tabelaProfessores");
        tabela.innerHTML = "";
        listaMapeada.forEach(({ obj: p, idx }) => {
          tabela.innerHTML += `
            <tr>
              <td>${p.nome}</td>
              <td>${p.cpf}</td>
              <td>${p.email}</td>
              <td>${p.departamento}</td>
              <td><button class="btn-apagar" onclick="apagar('professores', ${idx})">Apagar</button></td>
            </tr>`;
        });
        document.getElementById("statsProfessores").textContent = `Total: ${listaMapeada.length}`;
      }

      if (tipo === "cursos") {
        const tabela = document.getElementById("tabelaCursos");
        tabela.innerHTML = "";
        let totalAlunos = 0;
        listaMapeada.forEach(({ obj: c, idx }) => {
          const alunos = Array.isArray(c.alunos) ? c.alunos : [];
          totalAlunos += alunos.length;
          tabela.innerHTML += `
            <tr>
              <td>${c.nome}</td>
              <td>${c.professorResponsavel}</td>
              <td>${alunos.join(", ") || "-"}</td>
              <td>${alunos.length}</td>
              <td><button class="btn-apagar" onclick="apagar('cursos', ${idx})">Apagar</button></td>
            </tr>`;
        });
        document.getElementById("statsCursos").textContent =
          `Total de cursos: ${listaMapeada.length} | Total de alunos (somados nos cursos): ${totalAlunos}`;
      }
    }

    // Render inicial das tr√™s abas (e garante que os dados apare√ßam ao carregar)
    window.addEventListener('DOMContentLoaded', () => {
      filtrar('alunos');
      filtrar('professores');
      filtrar('cursos');
    });
  </script>
</body>
</html>
